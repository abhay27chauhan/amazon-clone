{"ast":null,"code":"import _objectSpread from\"/Users/abhaychauhan/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/Users/abhaychauhan/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _regeneratorRuntime from\"/Users/abhaychauhan/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/abhaychauhan/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/abhaychauhan/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import React,{useState,useEffect}from'react';import CurrencyFormat from'react-currency-format';import{Link,useHistory}from'react-router-dom';import CheckoutProduct from'../../components/CheckoutProduct/CheckoutProduct';import{ACTIONS,getBasketTotal}from'../../Hooks/reducer';import{useStateValue}from'../../Hooks/stateProvider';import axios from'../../axios';import'./Payment.css';import{db}from'../../firebase';function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),disabled=_useState4[0],setDisabled=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),succeeded=_useState8[0],setSucceeded=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',url:\"/payments/create?total=\".concat(getBasketTotal(basket)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log('THE SECRET IS >>>',clientSecret);console.log('THE USER >> ',user);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;// paymentIntent = payment confirmation\ndb.collection('users').doc(user===null||user===void 0?void 0:user.uid).collection('orders').doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created},{merge:true});setSucceeded(true);setError(null);setProcessing(false);dispatch({type:ACTIONS.EMPTY_BASKET});history.replace('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){// listen for changes in the CardElement\n// and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment__container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__address\",children:[/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"123 React Lane\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Delhi, India\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__items\",children:basket.map(function(_ref4){var id=_ref4.id,otherItemProps=_objectWithoutProperties(_ref4,[\"id\"]);return/*#__PURE__*/_jsx(CheckoutProduct,_objectSpread({id:id},otherItemProps));})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__priceContainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total: \",value]});},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["/Users/abhaychauhan/Desktop/amazon-clone/src/pages/Payment/Payment.js"],"names":["CardElement","useElements","useStripe","React","useState","useEffect","CurrencyFormat","Link","useHistory","CheckoutProduct","ACTIONS","getBasketTotal","useStateValue","axios","db","Payment","basket","user","dispatch","history","stripe","elements","error","setError","disabled","setDisabled","processing","setProcessing","succeeded","setSucceeded","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","collection","doc","uid","id","set","amount","created","merge","type","EMPTY_BASKET","replace","payload","handleChange","empty","message","length","email","map","otherItemProps","value"],"mappings":"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","sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport React, { useState, useEffect } from 'react';\nimport CurrencyFormat from 'react-currency-format';\nimport { Link, useHistory } from 'react-router-dom';\nimport CheckoutProduct from '../../components/CheckoutProduct/CheckoutProduct';\nimport { ACTIONS, getBasketTotal } from '../../Hooks/reducer';\nimport { useStateValue } from '../../Hooks/stateProvider';\nimport axios from '../../axios';\nimport './Payment.css';\nimport { db } from '../../firebase';\n\nfunction Payment() {\n    const[{basket, user}, dispatch] = useStateValue();\n\n    const history = useHistory();\n    \n    const stripe = useStripe();\n    const elements = useElements();\n\n    const[error, setError] = useState(null);\n    const[disabled, setDisabled] = useState(true);\n    const[processing, setProcessing] = useState(false);\n    const[succeeded, setSucceeded] = useState(false);\n    const[clientSecret, setClientSecret] = useState(true);\n\n    useEffect(() => {\n        const getClientSecret = async () => {\n            const response = await axios({\n                method: 'post',\n                url: `/payments/create?total=${getBasketTotal(basket) * 100}`,\n            });\n            setClientSecret(response.data.clientSecret)\n        }\n\n        getClientSecret();\n    }, [basket])\n\n    console.log('THE SECRET IS >>>', clientSecret);\n    console.log('THE USER >> ', user);\n\n    const handleSubmit = async (event) => {\n        event.preventDefault();\n        setProcessing(true);\n\n        const payload = await stripe.confirmCardPayment(clientSecret, {\n            payment_method: {\n                card: elements.getElement(CardElement)\n            }\n        }).then(({ paymentIntent }) => {\n            // paymentIntent = payment confirmation\n            db\n              .collection('users')\n              .doc(user?.uid)\n              .collection('orders')\n              .doc(paymentIntent.id)\n              .set({\n                  basket: basket,\n                  amount: paymentIntent.amount,\n                  created: paymentIntent.created\n              }, { merge: true })\n\n            setSucceeded(true);\n            setError(null);\n            setProcessing(false);\n\n            dispatch({\n                type: ACTIONS.EMPTY_BASKET\n            })\n\n            history.replace('/orders');\n        })\n    }\n\n    const handleChange = event => {\n        // listen for changes in the CardElement\n        // and display any errors as the customer types their card details\n        setDisabled(event.empty);\n        setError(event.error ? event.error.message : \"\");\n    }\n    \n    return (\n        <div className=\"payment\">\n            <div className=\"payment__container\">\n                <h1>\n                    Checkout (<Link to='/checkout'>{basket?.length} items</Link>)\n                </h1>\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Delivery Address</h3>\n                    </div>\n                    <div className=\"payment__address\">\n                        <p>{user?.email}</p>\n                        <p>123 React Lane</p>\n                        <p>Delhi, India</p>\n                    </div>\n                </div>\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Review items and delivery</h3>\n                    </div>\n                    <div className=\"payment__items\">\n                        {basket.map(({id, ...otherItemProps}) => (<CheckoutProduct id = {id} {...otherItemProps}/>))}\n                    </div>\n                </div>\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Payment Method</h3>\n                    </div>\n                    <div className=\"payment__details\">\n                        <form onSubmit={handleSubmit}>\n                            <CardElement onChange={handleChange} />\n                            <div className=\"payment__priceContainer\">\n                                <CurrencyFormat\n                                    renderText = {(value) => (\n                                        <h3>Order Total: {value}</h3>       \n                                    )}\n                                    decimalScale={2}\n                                    value={getBasketTotal(basket)}\n                                    displayType={\"text\"}\n                                    thousandSeparator={true}\n                                    prefix={\"$\"}\n                                />\n                                <button disabled={processing || disabled || succeeded}>\n                                        <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\n                                </button>\n                            </div>\n                                {error && <div>{error}</div>}\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default Payment;\n"]},"metadata":{},"sourceType":"module"}